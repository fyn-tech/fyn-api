packages:
  yum:
    jq: []

container_commands:
  01_create_env_file:
    command: |
      mkdir -p /opt/elasticbeanstalk/deployment
      /opt/elasticbeanstalk/bin/get-config environment | jq -r 'to_entries | .[] | "export \(.key)=\(.value)"' > /opt/elasticbeanstalk/deployment/env_vars
      chmod 755 /opt/elasticbeanstalk/deployment/env_vars
      leader_only: true

  02_collectstatic:
    command: |
      source /opt/elasticbeanstalk/deployment/env_vars
      sudo -u webapp /var/app/venv/*/bin/python manage.py collectstatic --noinput

    
  03_migrate:
    command: |
      source /opt/elasticbeanstalk/deployment/env_vars
      sudo -u webapp /var/app/venv/*/bin/python manage.py migrate
      leader_only: true

option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: fyn-api.wsgi:application
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /static: static